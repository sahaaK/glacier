<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SYLEAD Unemployment & Immigration Survey - Analysis Dashboard</title>
    <link rel="icon" href="https://sylead-surveys.netlify.app/logo.png">

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#f5f3ff',
                100: '#ede9fe',
                200: '#ddd6fe',
                300: '#c4b5fd',
                400: '#a78bfa',
                500: '#8b5cf6',
                600: '#7c3aed',
                700: '#6d28d9',
                800: '#5b21b6',
                900: '#4c1d95'
              },
              secondary: {
                50: '#ecfeff',
                100: '#cffafe',
                200: '#a5f3fc',
                300: '#67e8f9',
                400: '#22d3ee',
                500: '#06b6d4',
                600: '#0891b2',
                700: '#0e7490',
                800: '#155e75',
                900: '#164e63'
              }
            },
            fontFamily: {
              inter: ['Inter', 'ui-sans-serif', 'system-ui', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'Apple Color Emoji', 'Segoe UI Emoji']
            },
            boxShadow: {
              glass: '0 10px 30px rgba(0,0,0,0.35)',
              neon: '0 0 0 1px rgba(139,92,246,.35), 0 0 18px rgba(139,92,246,.25), inset 0 0 24px rgba(139,92,246,.08)'
            },
            backdropBlur: {
              xs: '2px'
            }
          }
        }
      }
    </script>

    <!-- AOS (Animate On Scroll) -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Firebase (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

      :root {
        --bg-start: #0b0b1d;
        --bg-end: #1a1033;
        --glass: rgba(17, 25, 40, 0.6);
        --glass-strong: rgba(17, 25, 40, 0.72);
        --glass-border: rgba(139, 92, 246, 0.25);
        --glass-highlight: rgba(255, 255, 255, 0.08);
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #8b5cf6;
        --accent-2: #22d3ee;
      }

      * { box-sizing: border-box; }

      html, body {
        font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        background: radial-gradient(1200px 600px at 10% -10%, rgba(139,92,246,0.25), transparent 60%),
                    radial-gradient(1000px 500px at 110% 10%, rgba(34,211,238,0.18), transparent 60%),
                    linear-gradient(160deg, var(--bg-start), var(--bg-end));
        color: var(--text);
        min-height: 100%;
      }

      .container {
        max-width: 1400px;
      }

      /* Subtle animated gradient sweep */
      .bg-sweep {
        position: fixed;
        inset: -200% -200% -200% -200%;
        background: conic-gradient(from 180deg at 50% 50%,
          rgba(139,92,246,0.0),
          rgba(139,92,246,0.12),
          rgba(34,211,238,0.0),
          rgba(34,211,238,0.12),
          rgba(139,92,246,0.0));
        animation: rotate 30s linear infinite;
        pointer-events: none;
        z-index: -2;
      }
      @keyframes rotate {
        to { transform: rotate(360deg); }
      }

      /* Glassmorphism card */
      .glass {
        background: var(--glass);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(16px) saturate(120%);
        -webkit-backdrop-filter: blur(16px) saturate(120%);
        box-shadow: var(--shadow, 0 10px 30px rgba(0,0,0,0.35));
        border-radius: 18px;
        position: relative;
        overflow: hidden;
      }

      .glass::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(400px 180px at -10% -10%, var(--glass-highlight), transparent 60%),
                    radial-gradient(300px 160px at 110% 10%, rgba(34,211,238,0.08), transparent 60%);
        pointer-events: none;
      }

      /* Metric card */
      .metric-card {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 18px;
        border-radius: 16px;
        background: var(--glass-strong);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(16px) saturate(140%);
        -webkit-backdrop-filter: blur(16px) saturate(140%);
        box-shadow: 0 10px 30px rgba(0,0,0,0.35), 0 0 0 1px rgba(139,92,246,0.1) inset;
        transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      }
      .metric-card:hover {
        transform: translateY(-4px);
        border-color: rgba(139,92,246,0.45);
        box-shadow: 0 18px 40px rgba(0,0,0,0.45), 0 0 24px rgba(139,92,246,0.25);
      }
      .metric-icon {
        width: 48px; height: 48px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        background: linear-gradient(135deg, rgba(139,92,246,0.25), rgba(34,211,238,0.18));
        border: 1px solid rgba(139,92,246,0.35);
        box-shadow: inset 0 0 24px rgba(139,92,246,0.15), 0 0 18px rgba(34,211,238,0.15);
      }
      .metric-content { line-height: 1.2; }
      .metric-label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: .08em; }
      .metric-value { font-size: 26px; font-weight: 800; }

      /* Chart card */
      .chart-card {
        background: var(--glass);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(16px) saturate(120%);
        -webkit-backdrop-filter: blur(16px) saturate(120%);
        box-shadow: 0 12px 34px rgba(0,0,0,0.35);
        border-radius: 20px;
        overflow: hidden;
        transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
        position: relative;
      }
      .chart-card:hover {
        transform: translateY(-5px);
        border-color: rgba(139,92,246,0.45);
        box-shadow: 0 18px 48px rgba(0,0,0,0.5), 0 0 28px rgba(139,92,246,0.25);
      }
      .chart-header {
        padding: 16px 18px 0 18px;
      }
      .chart-title {
        font-weight: 800;
        font-size: 16px;
        line-height: 1.2;
      }
      .chart-subtitle {
        color: var(--muted);
        font-size: 12px;
      }
      .chart-body {
        padding: 8px 14px 14px 14px;
      }

      /* Buttons */
      .btn-primary {
        display: inline-flex; align-items: center; gap: 8px;
        padding: 10px 14px;
        background: linear-gradient(135deg, rgba(139,92,246,0.9), rgba(34,211,238,0.85));
        color: #0b1020;
        border: 1px solid rgba(139,92,246,0.55);
        border-radius: 12px;
        font-weight: 800;
        letter-spacing: .02em;
        cursor: pointer;
        transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
        box-shadow: 0 10px 24px rgba(139,92,246,0.35), inset 0 -2px 0 rgba(255,255,255,0.15);
        text-shadow: 0 1px 0 rgba(255,255,255,0.25);
      }
      .btn-primary:hover {
        transform: translateY(-1px);
        filter: brightness(1.05) saturate(1.1);
        box-shadow: 0 14px 34px rgba(139,92,246,0.45);
      }
      .btn-secondary {
        display: inline-flex; align-items: center; gap: 8px;
        padding: 10px 14px;
        background: rgba(17,25,40,0.6);
        color: #d1d5db;
        border: 1px solid rgba(139,92,246,0.35);
        border-radius: 12px;
        font-weight: 700;
        letter-spacing: .02em;
        cursor: pointer;
        transition: background .2s ease, transform .2s ease, border-color .2s ease;
        backdrop-filter: blur(8px);
      }
      .btn-secondary:hover {
        background: rgba(17,25,40,0.8);
        border-color: rgba(139,92,246,0.6);
        transform: translateY(-1px);
      }

      /* Floating animated bubbles (subtle, behind content) */
      .bubble {
        position: absolute;
        border-radius: 9999px;
        filter: blur(2px);
        opacity: 0.35;
        animation: float 18s linear infinite;
        pointer-events: none;
      }
      .bubble-1 { width: 140px; height: 140px; background: #8b5cf6; top: 10%; left: 5%; animation-duration: 22s; }
      .bubble-2 { width: 200px; height: 200px; background: #22d3ee; top: 25%; right: 8%; animation-duration: 26s; }
      .bubble-3 { width: 110px; height: 110px; background: #34d399; bottom: 15%; left: 20%; animation-duration: 20s; }
      .bubble-4 { width: 180px; height: 180px; background: #f59e0b; bottom: 20%; right: 12%; animation-duration: 24s; }
      .bubble-5 { width: 130px; height: 130px; background: #f472b6; top: 50%; left: 50%; animation-duration: 28s; }
      .bubble-6 { width: 90px; height: 90px; background: #60a5fa; top: 60%; left: 35%; animation-duration: 19s; }

      @keyframes float {
        0% { transform: translateY(0) translateX(0) scale(1); }
        50% { transform: translateY(-30px) translateX(15px) scale(1.05); }
        100% { transform: translateY(0) translateX(0) scale(1); }
      }

      /* Subtle glow border on hover for charts */
      .glow-border {
        position: relative;
      }
      .glow-border::before {
        content: "";
        position: absolute; inset: -1px;
        border-radius: inherit;
        background: linear-gradient(135deg, rgba(139,92,246,0.6), rgba(34,211,238,0.6));
        opacity: 0; transition: opacity .25s ease;
        z-index: -1;
        filter: blur(10px);
      }
      .glow-border:hover::before { opacity: .65; }

      /* Responsive tweaks */
      @media (max-width: 640px) {
        .metric-value { font-size: 22px; }
      }
    </style>
</head>
<body class="min-h-screen text-gray-100 antialiased">
    <!-- Animated background sweep -->
    <div class="bg-sweep"></div>

    <!-- Floating Bubbles (subtle, behind content) -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
        <div class="bubble bubble-1"></div>
        <div class="bubble bubble-2"></div>
        <div class="bubble bubble-3"></div>
        <div class="bubble bubble-4"></div>
        <div class="bubble bubble-5"></div>
        <div class="bubble bubble-6"></div>
    </div>

    <!-- Header -->
    <header class="py-8" data-aos="fade-down">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                <div class="flex items-center gap-4">
                    <img src="https://sylead-surveys.netlify.app/logo.png" alt="SYLEAD" class="h-14 w-14 object-contain drop-shadow-[0_0_10px_rgba(139,92,246,0.6)]">
                    <div>
                        <h1 class="text-2xl lg:text-3xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-primary-300 via-primary-500 to-secondary-400">
                            Unemployment & Immigration Survey Analysis
                        </h1>
                        <p class="text-gray-400">SYLEAD - Dashboard, Insights & Visual Analytics</p>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
                    <div id="dataSourceBadge" class="inline-flex items-center gap-2 rounded-full px-4 py-2 bg-emerald-500/10 text-emerald-300 border border-emerald-400/30">
                        <i data-feather="database" class="w-4 h-4"></i>
                        <span class="text-sm font-medium" id="dataSourceText">Loading...</span>
                    </div>
                    <div id="lastUpdated" class="text-sm text-gray-400">Last updated: —</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Controls -->
    <section class="container mx-auto px-4 mb-6" data-aos="fade-up">
        <div class="glass p-4">
            <div class="flex flex-wrap items-center gap-4">
                <button id="refreshBtn" class="btn-primary">
                    <i data-feather="refresh-ccw" class="w-4 h-4"></i>
                    Refresh Data
                </button>
                <button id="exportPngBtn" class="btn-secondary">
                    <i data-feather="image" class="w-4 h-4"></i>
                    Export Charts as PNG
                </button>
                <button id="exportCsvBtn" class="btn-secondary">
                    <i data-feather="download-cloud" class="w-4 h-4"></i>
                    Export CSV
                </button>
                <div class="ml-auto text-sm text-gray-300">
                    Total Responses: <span id="totalResponses" class="font-semibold">—</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Top Metrics -->
    <section class="container mx-auto px-4 mb-8" data-aos="fade-up">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="metric-card">
                <div class="metric-icon text-primary-300">
                    <i data-feather="users"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-label">Total Responses</div>
                    <div class="metric-value" id="metricTotal">—</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon text-secondary-300">
                    <i data-feather="briefcase"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-label">Employment Rate</div>
                    <div class="metric-value" id="metricEmployment">—</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon text-rose-400">
                    <i data-feather="trending-down"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-label">Unemployment Rate</div>
                    <div class="metric-value" id="metricUnemployment">—</div>
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-icon text-amber-400">
                    <i data-feather="plane"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-label">Considering Emigration</div>
                    <div class="metric-value" id="metricEmigration">—</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Charts Grid -->
    <main class="container mx-auto px-4 pb-16">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Demographics: Gender -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Gender Distribution</h3>
                    <span class="chart-subtitle">Q1: Jinsiga</span>
                </div>
                <div class="chart-body">
                    <canvas id="genderChart" height="240"></canvas>
                </div>
            </div>

            <!-- Demographics: Age -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Age Groups</h3>
                    <span class="chart-subtitle">Q2: Da'da</span>
                </div>
                <div class="chart-body">
                    <canvas id="ageChart" height="240"></canvas>
                </div>
            </div>

            <!-- Demographics: Year in University -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Year of Study</h3>
                    <span class="chart-subtitle">Q3: Sanadka dhigashada jaamacadda</span>
                </div>
                <div class="chart-body">
                    <canvas id="yearChart" height="240"></canvas>
                </div>
            </div>

            <!-- Demographics: Faculty -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Faculty Distribution</h3>
                    <span class="chart-subtitle">Q4: Faculty-ga dhigashada</span>
                </div>
                <div class="chart-body">
                    <canvas id="facultyChart" height="240"></canvas>
                </div>
            </div>

            <!-- Employment Status -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Employment Status</h3>
                    <span class="chart-subtitle">Q5: Ma shaqo ayaad haysaa hadda?</span>
                </div>
                <div class="chart-body">
                    <canvas id="employmentChart" height="240"></canvas>
                </div>
            </div>

            <!-- Job Search Duration -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Job Search Duration</h3>
                    <span class="chart-subtitle">Q6: Muddada raadinta shaqo</span>
                </div>
                <div class="chart-body">
                    <canvas id="jobSearchChart" height="240"></canvas>
                </div>
            </div>

            <!-- Unemployment Reasons (Radar) -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Unemployment Reasons (Radar)</h3>
                    <span class="chart-subtitle">Q7: Sababta ugu weyn ee shaqo la'aanta</span>
                </div>
                <div class="chart-body">
                    <canvas id="unemploymentRadarChart" height="280"></canvas>
                </div>
            </div>

            <!-- Confidence in Finding a Job -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Confidence in Finding a Job</h3>
                    <span class="chart-subtitle">Q8: Kalsoonida helitaanka shaqo</span>
                </div>
                <div class="chart-body">
                    <canvas id="confidenceChart" height="240"></canvas>
                </div>
            </div>

            <!-- Business Idea Due to Unemployment -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Considering Business due to Unemployment</h3>
                    <span class="chart-subtitle">Q9: Ka fikrinta ganacsi bilowdo</span>
                </div>
                <div class="chart-body">
                    <canvas id="businessIdeaChart" height="240"></canvas>
                </div>
            </div>

            <!-- Emigration Consideration -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Emigration Consideration</h3>
                    <span class="chart-subtitle">Q10: Ka fikrinta inaad dalka ka baxdo</span>
                </div>
                <div class="chart-body">
                    <canvas id="emigrationChart" height="240"></canvas>
                </div>
            </div>

            <!-- Emigration Reasons -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Top Emigration Reasons</h3>
                    <span class="chart-subtitle">Q11: Sababta ugu weyn ee tahriibka</span>
                </div>
                <div class="chart-body">
                    <canvas id="emigrationReasonsChart" height="240"></canvas>
                </div>
            </div>

            <!-- Destination Countries -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Preferred Destinations</h3>
                    <span class="chart-subtitle">Q12: Meelaha aad jeclaan lahayd inaad tagto</span>
                </div>
                <div class="chart-body">
                    <canvas id="destinationChart" height="240"></canvas>
                </div>
            </div>

            <!-- Will You Return Home? -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Would You Return Home?</h3>
                    <span class="chart-subtitle">Q13: Ku soo laaban dalkaaga mustaqbalka?</span>
                </div>
                <div class="chart-body">
                    <canvas id="returnHomeChart" height="240"></canvas>
                </div>
            </div>

            <!-- Emigration Impact -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Perceived Impact of Emigration</h3>
                    <span class="chart-subtitle">Q14: Saameynta tahriibka dalka</span>
                </div>
                <div class="chart-body">
                    <canvas id="emigrationImpactChart" height="240"></canvas>
                </div>
            </div>

            <!-- University Support -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">University Support Adequacy</h3>
                    <span class="chart-subtitle">Q15: Jaamacadda taageero ku filan</span>
                </div>
                <div class="chart-body">
                    <canvas id="universitySupportChart" height="240"></canvas>
                </div>
            </div>

            <!-- University Actions -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Recommended University Actions</h3>
                    <span class="chart-subtitle">Q16: Talloo ay jaamacaduhu qaadan karaan</span>
                </div>
                <div class="chart-body">
                    <canvas id="universityActionsChart" height="240"></canvas>
                </div>
            </div>

            <!-- Government Policy Need -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Need for Government Policies</h3>
                    <span class="chart-subtitle">Q17: Baahida siyaasadda dowladda</span>
                </div>
                <div class="chart-body">
                    <canvas id="governmentPolicyChart" height="240"></canvas>
                </div>
            </div>

            <!-- SYLEAD Program Participation -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">SYLEAD Program Participation</h3>
                    <span class="chart-subtitle">Q18: Ka qayb gelinta barnaamijyada SYLEAD</span>
                </div>
                <div class="chart-body">
                    <canvas id="syleadProgramChart" height="240"></canvas>
                </div>
            </div>

            <!-- Future Outlook -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Future Career Outlook</h3>
                    <span class="chart-subtitle">Q19: Mustaqbalka shaqada</span>
                </div>
                <div class="chart-body">
                    <canvas id="futureOutlookChart" height="240"></canvas>
                </div>
            </div>

            <!-- Desire to Emigrate -->
            <div class="chart-card glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Desire to Emigrate</h3>
                    <span class="chart-subtitle">Q20: Rabitaanka tahriibto</span>
                </div>
                <div class="chart-body">
                    <canvas id="wantToEmigrateChart" height="240"></canvas>
                </div>
            </div>

            <!-- Comments Word Cloud (Bar) -->
            <div class="chart-card lg:col-span-2 glow-border" data-aos="zoom-in">
                <div class="chart-header">
                    <h3 class="chart-title">Comments Word Frequency</h3>
                    <span class="chart-subtitle">Q21: Taloyin iyo faallooyin (optional)</span>
                </div>
                <div class="chart-body">
                    <canvas id="commentsWordCloud" height="300"></canvas>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="py-8 border-t border-white/10">
        <div class="container mx-auto px-4 text-center text-gray-400 text-sm">
           2025 @SYLEAD
        </div>
    </footer>

    <script>
        /* SYLEAD Survey Analysis Dashboard Script */

const firebaseConfig = {
    apiKey: "AIzaSyBUc5hcM-aDwF3YqLkMrlGQ39aUKesAPwI",
    authDomain: "sylead-surveys.firebaseapp.com",
    projectId: "sylead-surveys",
    storageBucket: "sylead-surveys.firebasestorage.app",
    messagingSenderId: "1022858819367",
    appId: "1:1022858819367:web:819cc345a439ccb691db02",
    measurementId: "G-E9E04BWX5Y"
};

// Neon chart palette
const palette = [
    "#8b5cf6", // violet
    "#22d3ee", // cyan
    "#34d399", // emerald
    "#f59e0b", // amber
    "#ef4444", // red
    "#f472b6", // pink
    "#60a5fa", // blue
    "#a78bfa", // purple light
    "#10b981", // green
    "#eab308", // yellow
    "#f97316", // orange
    "#6366f1", // indigo
    "#84cc16", // lime
    "#ec4899", // pink darker
    "#14b8a6"  // teal
];

let charts = {};
let lastDataSnapshot = [];

/* Initialize Firebase */
let app, db;
try {
    app = firebase.initializeApp(firebaseConfig);
    db = firebase.firestore();
} catch (e) {
    console.warn("Firebase init failed; falling back to sample data.", e);
}

function qs(sel) { return document.querySelector(sel); }
function qsa(sel) { return Array.from(document.querySelectorAll(sel)); }

function setBadge(source) {
    const badge = qs("#dataSourceBadge");
    const txt = qs("#dataSourceText");
    if (source === "firebase") {
        badge.className = "inline-flex items-center gap-2 rounded-full px-4 py-2 bg-emerald-500/10 text-emerald-300 border border-emerald-400/30";
        txt.textContent = "Live Data (Firestore)";
    } else {
        badge.className = "inline-flex items-center gap-2 rounded-full px-4 py-2 bg-amber-500/10 text-amber-300 border border-amber-400/30";
        txt.textContent = "Sample Data (Mock)";
    }
}

/* Data fetching: Firestore -> documents */
async function fetchSurveyData() {
    if (!db) {
        return { source: "sample", data: sampleData() };
    }
    try {
        const snapshot = await db.collection("unemployment survey").get();
        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        if (!data.length) {
            console.info("Firestore collection is empty. Using sample data.");
            return { source: "sample", data: sampleData() };
        }
        return { source: "firebase", data };
    } catch (err) {
        console.warn("Firestore read failed; using sample data.", err);
        return { source: "sample", data: sampleData() };
    }
}

/* Sample mock dataset for demo purposes */
function sampleData() {
    const genders = ["Lab", "Dhedig"];
    const ages = ["18-21", "22-25", "26-30"];
    const years = ["1st", "2nd", "3rd", "4th+"];
    const faculties = ["Social science and law", "Business and commerce", "Engineering and technology", "Health and medicine", "Education/sharia"];
    const employment = ["Full time", "Part time", "No"];
    const jobDurations = ["<3 months", "3-6 months", "6-12 months", ">1 year", "Not searching"];
    const unempReasons = ["Few job opportunities", "Lack of skills", "Nepotism", "Low education quality", "Lack of experience"];
    const confidence = ["Very confident", "Somewhat confident", "Not confident", "Not sure"];
    const businessIdea = ["Yes", "No", "Maybe"];
    const emigration = ["Yes", "No"];
    const emigrationReasons = ["Better job opportunities", "Higher education", "Better life and services", "Security and stability", "Family abroad"];
    const destinations = ["Europe", "America", "Middle East", "Africa", "Asia"];
    const returnHome = ["Yes, fully", "Maybe", "No", "Not sure"];
    const emigrationImpact = ["Positive", "Negative", "Both", "Not sure"];
    const universitySupport = ["Yes", "No", "Yes but can improve"];
    const universityActions = ["Training and internship programs", "Business and entrepreneurship training", "Job search counseling", "Job fairs and networking"];
    const governmentPolicy = ["Yes", "No"];
    const syleadProgram = ["Yes", "No", "Maybe"];
    const futureOutlook = ["Optimistic", "Neutral", "Pessimistic", "Not sure"];
    const wantToEmigrate = ["Yes 100%", "Would like but can't", "No, I like my country"];

    const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
    const arr = [];
    for (let i = 0; i < 120; i++) {
        arr.push({
            gender: rand(genders),
            age: rand(ages),
            year: rand(years),
            faculty: rand(faculties),
            employment: rand(employment),
            jobSearchDuration: rand(jobDurations),
            unemploymentReason: rand(unempReasons),
            confidence: rand(confidence),
            businessIdea: rand(businessIdea),
            emigration: rand(emigration),
            emigrationReason: rand(emigrationReasons),
            destination: rand(destinations),
            returnHome: rand(returnHome),
            emigrationImpact: rand(emigrationImpact),
            universitySupport: rand(universitySupport),
            universityAction: rand(universityActions),
            governmentPolicy: rand(governmentPolicy),
            syleadProgram: rand(syleadProgram),
            futureOutlook: rand(futureOutlook),
            wantToEmigrate: rand(wantToEmigrate),
            comments: Math.random() > 0.7 ? "I think the government should create more job programs for graduates and encourage entrepreneurship." : ""
        });
    }
    return arr;
}

/* Utilities */
function countBy(arr, key) {
    const map = new Map();
    arr.forEach(item => {
        const val = item?.[key];
        if (!val) return;
        const k = String(val).trim();
        map.set(k, (map.get(k) || 0) + 1);
    });
    // Sort by value desc
    return Array.from(map.entries()).sort((a, b) => b[1] - a[1]);
}
function pct(part, total) {
    return total ? ((part / total) * 100).toFixed(1) + "%" : "0%";
}
function flattenComments(arr) {
    return arr.map(a => a?.comments).filter(Boolean);
}
function stopWords() {
    return new Set([
        "i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves",
        "what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of",
        "at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where",
        "why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","can","will","just","don","should","now","ma","ay","waxaan","lakin","in","ka","ee","si",
        "lahaad","lahayd","u","la","aad","mid","nooc","laakiin","istaa","ayaa","ayay","qoraal","qor","faallo","talo","dalka","dalki","dhalinyarada","shqlo","shaqo","jaamacadda","shirkad","shirkada","isku","ay","yaqaan","waxa","waxay","sida",
        "dhigashada","dhigato","sano","sanadka","hadda","mustaqbalka","ma","maya","haa","wixii","kii","kaa","kuu","noqo","nuqul","kale","qaar","qaartee","sidee","side","sideena","daraasad","daraasadda","aynu","ayn","ayaan"
    ]);
}
function wordFrequency(textArray) {
    const words = [];
    textArray.forEach(t => {
        String(t).toLowerCase().replace(/[^a-z0-9\s']/g, " ").split(/\s+/).forEach(w => {
            if (!w || w.length < 3) return;
            words.push(w);
        });
    });
    const map = new Map();
    const banned = stopWords();
    words.forEach(w => {
        if (banned.has(w)) return;
        map.set(w, (map.get(w) || 0) + 1);
    });
    return Array.from(map.entries()).sort((a,b) => b[1]-a[1]).slice(0, 25);
}

/* Chart helpers */
function destroyChart(id) {
    if (charts[id]) {
        charts[id].destroy();
        delete charts[id];
    }
}
function makeChart(id, config) {
    destroyChart(id);
    const ctx = document.getElementById(id);
    if (!ctx) return;

    // Dark theme defaults
    const baseOptions = {
      responsive: true,
      plugins: {
        legend: {
          labels: { color: '#cbd5e1', usePointStyle: true, padding: 16 }
        },
        tooltip: {
          backgroundColor: 'rgba(15, 23, 42, 0.9)',
          titleColor: '#e5e7eb',
          bodyColor: '#e5e7eb',
          borderColor: 'rgba(139, 92, 246, 0.45)',
          borderWidth: 1
        }
      },
      animation: {
        duration: 900,
        easing: 'easeOutQuart'
      }
    };
    const mergedConfig = { ...config, options: { ...baseOptions, ...(config.options || {}) } };
    charts[id] = new Chart(ctx, mergedConfig);
}
function pieConfig(id, labels, values, title) {
    return {
        type: 'pie',
        data: {
            labels,
            datasets: [{
                data: values,
                backgroundColor: labels.map((_, i) => palette[i % palette.length]),
                borderColor: "rgba(0,0,0,0.0)",
                borderWidth: 2,
                hoverOffset: 6
            }]
        },
        options: {}
    };
}
function doughnutConfig(id, labels, values, title) {
    return {
        type: 'doughnut',
        data: {
            labels,
            datasets: [{
                data: values,
                backgroundColor: labels.map((_, i) => palette[i % palette.length]),
                borderColor: "rgba(0,0,0,0.0)",
                borderWidth: 2,
                hoverOffset: 6
            }]
        },
        options: {
            cutout: "58%",
            plugins: { legend: { position: 'bottom' } }
        }
    };
}
function barConfig(id, labels, values, title, horizontal = false) {
    return {
        type: 'bar',
        data: {
            labels,
            datasets: [{
                label: 'Count',
                data: values,
                backgroundColor: labels.map((_, i) => palette[i % palette.length]),
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            indexAxis: horizontal ? 'y' : 'x',
            scales: {
                x: { grid: { color: "rgba(148,163,184,0.12)" }, ticks: { color: "#cbd5e1" } },
                y: { grid: { color: "rgba(148,163,184,0.12)" }, ticks: { color: "#cbd5e1" } }
            },
            plugins: { legend: { display: false } }
        }
    };
}
function lineConfig(id, labels, values, title) {
    return {
        type: 'line',
        data: {
            labels,
            datasets: [{
                label: 'Count',
                data: values,
                borderColor: palette[0],
                backgroundColor: "rgba(139,92,246,0.15)",
                tension: 0.35,
                fill: true,
                pointBackgroundColor: palette[0],
                pointRadius: 4
            }]
        },
        options: {
            scales: {
                x: { grid: { color: "rgba(148,163,184,0.12)" }, ticks: { color: "#cbd5e1" } },
                y: { grid: { color: "rgba(148,163,184,0.12)" }, ticks: { color: "#cbd5e1" } }
            },
            plugins: { legend: { display: false } }
        }
    };
}
function radarConfig(id, labels, values, title) {
    return {
        type: 'radar',
        data: {
            labels,
            datasets: [{
                label: 'Responses',
                data: values,
                backgroundColor: "rgba(139,92,246,0.20)",
                borderColor: palette[0],
                pointBackgroundColor: palette[0],
                pointBorderColor: "#fff",
                pointHoverBackgroundColor: "#fff",
                pointHoverBorderColor: palette[0]
            }]
        },
        options: {
            scales: {
                r: {
                    angleLines: { color: "rgba(148,163,184,0.2)" },
                    grid: { color: "rgba(148,163,184,0.2)" },
                    pointLabels: { color: "#cbd5e1" },
                    ticks: { display: false }
                }
            },
            plugins: { legend: { display: false } }
        }
    };
}

/* Rendering */
function renderAll(data) {
    const total = data.length;
    lastDataSnapshot = data;

    qs("#totalResponses").textContent = total;
    qs("#metricTotal").textContent = total;

    // Metrics
    const employed = countBy(data, "employment");
    const empFull = +(employed.find(x => x[0] === "Full time")?.[1] || 0);
    const empPart = +(employed.find(x => x[0] === "Part time")?.[1] || 0);
    const empTotal = empFull + empPart;
    const unemployed = +(employed.find(x => x[0] === "No")?.[1] || 0);

    qs("#metricEmployment").textContent = pct(empTotal, total);
    qs("#metricUnemployment").textContent = pct(unemployed, total);

    const emigrationYes = +(countBy(data, "emigration").find(x => x[0] === "Yes")?.[1] || 0);
    qs("#metricEmigration").textContent = pct(emigrationYes, total);

    // Charts
    const gender = countBy(data, "gender");
    makeChart("genderChart", pieConfig("genderChart", gender.map(x => x[0]), gender.map(x => x[1])));

    const age = countBy(data, "age");
    makeChart("ageChart", barConfig("ageChart", age.map(x => x[0]), age.map(x => x[1])));

    const year = countBy(data, "year");
    makeChart("yearChart", barConfig("yearChart", year.map(x => x[0]), year.map(x => x[1])));

    const faculty = countBy(data, "faculty");
    makeChart("facultyChart", doughnutConfig("facultyChart", faculty.map(x => x[0]), faculty.map(x => x[1])));

    const employment = countBy(data, "employment");
    makeChart("employmentChart", doughnutConfig("employmentChart", employment.map(x => x[0]), employment.map(x => x[1])));

    const jobSearch = countBy(data, "jobSearchDuration");
    makeChart("jobSearchChart", lineConfig("jobSearchChart", jobSearch.map(x => x[0]), jobSearch.map(x => x[1])));

    const unempReason = countBy(data, "unemploymentReason");
    makeChart("unemploymentRadarChart", radarConfig("unemploymentRadarChart", unempReason.map(x => x[0]), unempReason.map(x => x[1])));

    const confidence = countBy(data, "confidence");
    makeChart("confidenceChart", barConfig("confidenceChart", confidence.map(x => x[0]), confidence.map(x => x[1])));

    const businessIdea = countBy(data, "businessIdea");
    makeChart("businessIdeaChart", barConfig("businessIdeaChart", businessIdea.map(x => x[0]), businessIdea.map(x => x[1])));

    const emigration = countBy(data, "emigration");
    makeChart("emigrationChart", pieConfig("emigrationChart", emigration.map(x => x[0]), emigration.map(x => x[1])));

    const emigrationReasons = countBy(data, "emigrationReason");
    makeChart("emigrationReasonsChart", barConfig("emigrationReasonsChart", emigrationReasons.map(x => x[0]), emigrationReasons.map(x => x[1])));

    const destinations = countBy(data, "destination");
    makeChart("destinationChart", barConfig("destinationChart", destinations.map(x => x[0]), destinations.map(x => x[1])));

    const returnHome = countBy(data, "returnHome");
    makeChart("returnHomeChart", barConfig("returnHomeChart", returnHome.map(x => x[0]), returnHome.map(x => x[1])));

    const emigrationImpact = countBy(data, "emigrationImpact");
    makeChart("emigrationImpactChart", doughnutConfig("emigrationImpactChart", emigrationImpact.map(x => x[0]), emigrationImpact.map(x => x[1])));

    const universitySupport = countBy(data, "universitySupport");
    makeChart("universitySupportChart", barConfig("universitySupportChart", universitySupport.map(x => x[0]), universitySupport.map(x => x[1])));

    const universityActions = countBy(data, "universityAction");
    makeChart("universityActionsChart", barConfig("universityActionsChart", universityActions.map(x => x[0]), universityActions.map(x => x[1])));

    const governmentPolicy = countBy(data, "governmentPolicy");
    makeChart("governmentPolicyChart", pieConfig("governmentPolicyChart", governmentPolicy.map(x => x[0]), governmentPolicy.map(x => x[1])));

    const syleadProgram = countBy(data, "syleadProgram");
    makeChart("syleadProgramChart", barConfig("syleadProgramChart", syleadProgram.map(x => x[0]), syleadProgram.map(x => x[1])));

    const futureOutlook = countBy(data, "futureOutlook");
    makeChart("futureOutlookChart", barConfig("futureOutlookChart", futureOutlook.map(x => x[0]), futureOutlook.map(x => x[1])));

    const wantToEmigrate = countBy(data, "wantToEmigrate");
    makeChart("wantToEmigrateChart", barConfig("wantToEmigrateChart", wantToEmigrate.map(x => x[0]), wantToEmigrate.map(x => x[1])));

    const words = wordFrequency(flattenComments(data));
    makeChart("commentsWordCloud", barConfig("commentsWordCloud", words.map(x => x[0]), words.map(x => x[1])));

    qs("#lastUpdated").textContent = "Last updated: " + new Date().toLocaleString();
}

/* Export functions */
function exportChartsAsPNG() {
    Object.entries(charts).forEach(([id, chart]) => {
        const url = chart.toBase64Image("image/png", 1);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${id}.png`;
        a.click();
    });
}
function exportCSV() {
    const headers = [
        "gender","age","year","faculty","employment","jobSearchDuration","unemploymentReason","confidence",
        "businessIdea","emigration","emigrationReason","destination","returnHome","emigrationImpact",
        "universitySupport","universityAction","governmentPolicy","syleadProgram","futureOutlook","wantToEmigrate","comments"
    ];
    const rows = lastDataSnapshot.map(obj => headers.map(h => {
        const v = obj?.[h] ?? "";
        const s = String(v).replace(/"/g, '""');
        return `"${s}"`;
    }));
    const csv = [headers.join(","), ...rows.map(r => r.join(","))].join("\n");
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "sylead_survey_export.csv";
    a.click();
    URL.revokeObjectURL(url);
}

/* Event bindings */
qs("#refreshBtn").addEventListener("click", async () => {
    const { source, data } = await fetchSurveyData();
    setBadge(source);
    renderAll(data);
});
qs("#exportPngBtn").addEventListener("click", exportChartsAsPNG);
qs("#exportCsvBtn").addEventListener("click", exportCSV);

/* Initial load */
(async function init() {
    const { source, data } = await fetchSurveyData();
    setBadge(source);
    renderAll(data);
})();
    </script>
    <script>
        // Replace icons
        feather.replace();

        // Initialize AOS
        AOS.init({ duration: 700, once: true });
    </script>
</body>
</html>
